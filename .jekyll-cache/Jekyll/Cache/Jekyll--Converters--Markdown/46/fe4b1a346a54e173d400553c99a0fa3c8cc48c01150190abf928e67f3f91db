I"÷I<p>As the end of my studies in nigh, I‚Äôm looking into possible topics for my master thesis. Alas, I‚Äôve grown a bit tired of writing game engines and renderers lately ‚Äì who‚Äôd have thought. So, seeing as I‚Äôve also developed an interest in procedural generation and always had a bit of a fascination for fantasy worlds and maps, I‚Äôve decided to work on procedural world generation.</p>

<p>This is obviously going to be a <a href="https://dwarffortresswiki.org/index.php?title=DF2014:Fun&amp;redirect=no">fun</a> project with much potential for interesting failures.<sup class="footnote" onclick="showFootnote(this)" title="But as Gordon Moore put it: If everything you try works, you aren't trying hard enough.">[1]</sup> Therefore, I have the best intentions of documenting my plans, progress and interesting problems here. With best intentions I do of course mean ‚Äò‚Äòforce myself‚Äô‚Äô and with documenting I mean ‚Äò‚Äòdumb my thoughts here and try to make sense of it all here‚Äô‚Äô.</p>

<p>So without further ado: Welcome to this unwise mix of <a href="https://heredragonsabound.blogspot.com/2020/02/the-forever-project.html">forever project</a> and master thesis.</p>

<!--more-->

<video loop="" muted="" inline="" autoplay="" controls="" style="width:100%; max-width: 40em; display: block; margin: auto">
	<source src="/assets/images/01/jericho.webm" type="video/webm" />
</video>

<h2 id="related-work">Related Work</h2>

<p>There already are quite a lot of inspiring projects that procedurally generate worlds and maps with impressive results. And also some scientific papers that I might use as a basis for my project. Although, most of these are sadly closed source projects.</p>

<div class="image_list">

  <figure class="captioned_image fixed_height fill_black">
	<a class="open_img" href="/assets/images/01/dwarf-fortress.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/dwarf-fortress.png" alt="" />
	</a>
  <figcaption>Dwarf Fortress is arguably the first thing that comes to mind, when people think about procedural generation of game worlds. Sadly concrete information about the generation algorithms is a bit sparse. But the generation starts with layers of noise based fractal maps for terrain/precipitation/..., that form the initial map and are then refined by simulation steps. The main focus and most impressive part is of course the history generation and simulation of the actual game world. In contrast, the terrain generation is sadly relatively unimpressive.</figcaption>
</figure>

  <figure class="captioned_image fixed_height crop">
	<a class="open_img" href="/assets/images/01/red_blob_mapgen4.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/red_blob_mapgen4.png" alt="" />
	</a>
  <figcaption><a href="https://www.redblobgames.com/maps/mapgen4/">Amit Patel's Mapgen 4</a> (as well as its <a href="https://www.redblobgames.com/maps/mapgen2/">previous iterations</a>) is also quite interesting. Especially because it's quite <a href="http://www-cs-students.stanford.edu/~amitp/game-programming/polygon-map-generation/">thoroughly</a> <a href="https://simblob.blogspot.com/search/label/mapgen4">documented</a> on his blog. It uses a relaxed voronoi diagram and its dual (delaunay triangulation) as its fundamental data-structure to generate interesting maps without the obvious artifacts often seen with uniform grids. Mapgen4 allows for quite intuitive editing of the elevation and generation parameters, with procedural generation of rivers, precipitation and biomes. But the most interesting part for me personally is the rendering, which utilizes a traditional rendering pipeline with an oblique projection and more artistic lighting to achieve a style that is quite close to a hand-drawn look.</figcaption>
</figure>

  <figure class="captioned_image fixed_height fill">
	<a class="open_img" href="/assets/images/01/dragons_abound.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/dragons_abound.png" alt="" />
	</a>
  <figcaption><a href="https://heredragonsabound.blogspot.com">Scott Turner's Dragons Abound</a> procedurally generates and draws fantasy maps, with quite beautiful and adaptable results that are already often near-indistinguishable from hand drawn maps. Although the main focus seems to be on drawing the maps, which informed some of the design decisions, there are also some simulation-based approaches to determine climates, precipitation and rivers. There are some technical similarities to Amit Patel's approach, insofar as both use delaunay triangulations as their fundamental data-structure. But Dragons Abound seems to use a much larger amount of vertices, which support smaller features and produces more natural shapes.</figcaption>
</figure>

  <figure class="captioned_image fixed_height crop">
	<a class="open_img" href="/assets/images/01/azgaar.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/azgaar.png" alt="" />
	</a>
  <figcaption><a href="https://azgaar.github.io/Fantasy-Map-Generator/">Azgaar's Fantasy Map Generator</a> is another fascinating project, that not only provides a working web application to interactively generate detailed fantasy maps but is also <a href="https://github.com/Azgaar/Fantasy-Map-Generator">open source</a>. And there is even a (sadly currently inactive) <a href="https://azgaar.wordpress.com">blog</a> with interesting details about its design and inner workings. As in the previous two, this generator uses a voronoi graph, but the focus seems to lie much more on the generation. Though, the most impressive part of this project is probably the insane amount of possible customization and editing of the generated maps.</figcaption>
</figure>

  <figure class="captioned_image fixed_height crop">
	<a class="open_img" href="/assets/images/01/undiscoveredworlds.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/undiscoveredworlds.png" alt="" />
	</a>
  <figcaption><a href="https://undiscoveredworlds.blogspot.com">JonathanCR's Undiscovered Worlds</a> is a procedural world generation project, inspired by Dragons Abound. But the aim of this project is more to generate complete worlds instead of drawing maps with relatively small/local scale, which is especially interesting as its close to my current plans.</figcaption>
</figure>

  <figure class="captioned_image fixed_height fill_white">
	<a class="open_img" href="/assets/images/01/Procedural Tectonic Planets.gif" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/Procedural Tectonic Planets.gif" alt="" />
	</a>
  <figcaption><a href="https://hal.archives-ouvertes.fr/hal-02136820/file/2019-Procedural-Tectonic-Planets.pdf">Procedural Tectonic Planets by Cortial et al.</a> is a paper from 2019 that proposes a model to procedurally generate planets using a simplified simulation of plate tectonics. Although the authors sadly didn't provide their source code or an executable to reproduce their results, the provided images and <a href="https://www.youtube.com/watch?v=GJQVl6Xld0w">video</a> look quite promising.</figcaption>
</figure>

  <figure class="captioned_image fixed_height crop">
	<a class="open_img" href="/assets/images/01/Large Scale Terrain Generation from Tectonic Uplift and Fluvial Erosion.png" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/Large Scale Terrain Generation from Tectonic Uplift and Fluvial Erosion.png" alt="" />
	</a>
  <figcaption><a href="https://hal.inria.fr/hal-01262376/document">Large Scale Terrain Generation from Tectonic Uplift and Fluvial Erosion by Cordonnier et al.</a> is paper from 2017 that uses tectonic uplift and hydraulic erosion data to generate plausible terrains. Although the scale is more local than my current plans, this might be an interesting approach to simulate erosion and river formation at a relatively high level, too.</figcaption>
</figure>

  <figure class="captioned_image fixed_height crop">
	<a class="open_img" href="/assets/images/01/wonderdraft.jpg" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/wonderdraft.jpg" alt="" />
	</a>
  <figcaption><a href="https://www.wonderdraft.net">Wonderdraft</a> is a quite powerful and easy to used editor to manually create fantasy maps. It doesn't really provide much in terms of procedural generation but might be an interesting reference as far as user editing of the generated data is concerned. There might also be an interesting potential in integrating a more powerful procedural generation toolkit with it, but in the absence of any API or documented file format that seems to be unrealistic for now.</figcaption>
</figure>

  <figure class="captioned_image fixed_height fill_black">
	<a class="open_img" href="/assets/images/01/voxel_farm.gif" target="_blank" rel="noopener noreferrer" onclick="show_image_overlay(event, this)">
		<img style="float:none; max-height:20em" src="/assets/images/01/voxel_farm.gif" alt="" />
	</a>
  <figcaption><a href="https://www.voxelfarm.com/index.html">Miguel Cepero's Voxel Farm</a> is another interesting project and his <a href="http://procworld.blogspot.com">blog</a> is one of the reasons I originally became interested in 3D graphics and procedural generation. In contrast to most projects in this list it generates not just a map of a world but an actual interactive 3D world. This is obviously far outside of any reasonable scope for me, but some of the more abstract ideas might still be interesting.</figcaption>
</figure>

</div>

<h2 id="project-aims">Project Aims</h2>

<p>So what exactly is it I‚Äôm trying to achieve here? My main focus is going to be not too different from that of Undiscovered Worlds. I‚Äôm mostly interested in generating plausible worlds that can be explored, used and processed further by others. Of course, I‚Äôll also have to visualize my results in the form of maps and provide some form of user input, but that probably won‚Äôt be anything to fancy.</p>

<p>Beside that, I have three main aims for this project to guide my design decisions.</p>

<h3 id="simulation-instead-of-noise">Simulation Instead of Noise</h3>
<p>As I‚Äôm mostly interested in the world generation aspect I want to try to reduce the amount of random input and noise to a minimum and rely on simulations instead. A model based on a large amount of complexly layered noise might generate interesting worlds, but that is entirely thanks to how that noise is modulated instead of any real meaningful capabilities of the system. And as an effect of this, the generational space of such models is inherently limited to the small subset for which the parameters have been hand-tuned. As John von Neumann famously said:</p>
<blockquote>
  <p>With four parameters I can fit an elephant, and with five I can make him wiggle his trunk.</p>
</blockquote>

<p>But my goal is to create a more generalized system that can generate a wide variety of interesting worlds.</p>

<p>While ‚Äúinteresting‚Äù is a quite subjective term, I think one intriguing way to look at a way to measure it is in terms of the entropy of the generated world, i.e. its information density, uncertainty or ‚Äúsurprisingness‚Äù<sup class="footnote" onclick="showFootnote(this)" title="&quot;The world is made up of four elements: Earth, Air, Fire and Water.  This is a fact well known even to Corporal Nobbs. It‚Äôs also wrong.  There‚Äôs a fifth element, and generally it‚Äôs called Surprise.&quot; -- Sir Terry Pratchett ">[2]</sup>. On one end of the spectrum, with an entropy near zero, we have an entirely flat featureless plane. Which we can probably agree on, could not really be described as interesting. And on the other end, with a large entropy, we have a comprehensively incomprehensible world, where everything appears to be random noise because nothing is correlated.</p>

<p>Noise based terrain, while often beautiful, would probably lie mostly on the low-entopie-end ‚Äì think rolling hills, uniform mountains and general predictability ‚Äì while our real world would be more on the high-end. The sweat spot I‚Äôm aiming for lies somewhere between these two, less predictable than perlin noise but also not as opaque and complex as the real world.</p>

<p>In other words, what I want to achieve here is a <em>comprehensible</em> amount of <em>meaningful</em> information in the generated worlds. So every visible feature should have a <em>cause</em> that can be discovered by the user, e.g. matching coasts where continents split apart, canyons where rivers used to flow, settlements where they actually make sense with names based on their surroundings and history. Aside from the general technical difficulty, striking the right balance will also be a problem here. Because an unbroken chain of cause and effect is utterly meaningless if it‚Äôs too complex to be easily comprehensible and the generated world becomes no more interesting than one based purely on random noise.</p>

<h3 id="realistic-scale">Realistic Scale</h3>

<p>My second large aim for this project is the scale at which I want to generate worlds. To support physically meaningful parameters and allow for an easier comparison with the real world, I‚Äôm planing to generate spherical worlds on roughly the same scale as earth, i.e. a radius of about 6‚Äô000 km.</p>

<p>To support such a large scale with any amount of local details I‚Äôm going to use a triangle mesh to store the elevation and other information. This should allow for a wide variety of resolutions based on local requirements (i.a. fewer vertices in the ocean and more near coasts and mountains). And this should also solve most of the problems and artifacts, encountered when one tries to use uniform rectangular grids like bitmaps and a spherical surface.</p>

<p>I‚Äôm currently planing to develop my generator in a top-down fashion, starting with the largest terrain features like tectonic plates and mountains and moving on to smaller scale details like rivers, caves and settlements from there. Although the dynamic resolution of a triangle mesh should lend itself well to such a generation approach, I might come to a point in the future where I need to split the system into multiple generators for different scales (e.g. erosion at the scale of a continent or mountain range vs. the scale of a local river). But that should also mesh quite well with the triangle mesh approach, as the small-scale-generator could use the vertices from the high-level generator, refine them further and generate new information matching the constraints determined by the existing vertices. There will also be many interesting problems there, like the usual problem with discontinuities at the border between cells, of course. But that is far enough in the future that I probably shouldn‚Äôt concern myself with it, just now.</p>

<h3 id="reusability">Reusability</h3>

<p>And my final aim for this project stems from my inkling that I might have bitten off more than I can chew here. Because of that I want to build the project in a fashion that even in its incomplete state, parts of it should still be usefull or at least of interest to others. To achieve that I‚Äôve not just <a href="https://gitlab.com/proc_world_gen">open sources (most) of the project</a> but also plan to structure it as modular as possible.</p>

<p>I already laid the foundation for this with a basic C-API for the world-model and generation passes. While I‚Äôll initially just work on a C++API-Wrapper to use in my code, the C-API core should also allow for future interoperability with other languages like Python or C#.</p>

<p>Based on this I plan to develop a simple graphical editor as a debugging tool and construct all the actual procedural generation passes as self-contained reusable modules, that can be loaded as plugins (.dll/.so) at runtime. So others should (at least in theory) be able to modify (or salvage) any interesting parts, extend the system with new functionality or use it as a starting point for their own projects.</p>

<h2 id="outlook">Outlook</h2>

<p>So, with the goal in mind and the course set: What will the next blog posts be about?</p>

<p>While I would really like to dive directly into exploring ideas for procgen algorithms and interesting simulation approaches, I think I should document and discuss some of the groundwork, first. So the next couple of posts will mostly focus on how the world is modeled, stored and modified in the code<sup class="footnote" onclick="showFootnote(this)" title="Which means the next three posts could be skipped by anyone that is not deeply fascinated by data structures, gets bored easily (despite some colorful pictures!) or suffers from a pathological fear of graph theory.">[3]</sup>.</p>

<p>But after that there a some (hopefully a bit lighter) topics, I would like to explore:</p>
<ul>
  <li>Simulating plate tectonics to generate realistic high-level features (probably based on <a href="https://hal.archives-ouvertes.fr/hal-02136820/file/2019-Procedural-Tectonic-Planets.pdf">Procedural Tectonic Planets by Cortial et al.</a>)</li>
  <li>Extending and refining the current API</li>
  <li>Creating a renderer to display the generated information in a compact way, that is easy to decipher</li>
  <li>Creating easy to use tools to modify the generated worlds, both for debugging and artistic inputs</li>
  <li>Simulating large scale weather patterns to determine precipitation, average temperatures and biomes</li>
  <li>Model drainage basins and high level water flow to generate river systems</li>
  <li>Generate detail maps for smaller areas, based on the high-level features from the coarser large-scale map</li>
  <li>Simulate coarse erosion based on this (maybe similar to <a href="https://hal.inria.fr/hal-01262376/document">Large Scale Terrain Generation from Tectonic Uplift and Fluvial Erosion by Cordonnier et al.</a>)</li>
  <li>Simulate large scale climate changes (i.e. ice ages and glaciation) to reproduce some of the more interesting terrain features we have on earth: fjords, <a href="https://en.wikipedia.org/wiki/Doggerland">sunken landmasses</a>, interesting features on continental shelves, ‚Ä¶</li>
  <li>‚Ä¶</li>
</ul>

:ET